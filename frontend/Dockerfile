# Node.js 18 ê¸°ë°˜ ì´ë¯¸ì§€
FROM node:18

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# Docker Composeì—ì„œ ë„˜ê¸´ NODE_ENVë¥¼ ë°›ìŒ
ARG BUILD_MODE

# package.jsonê³¼ package-lock.json ë³µì‚¬
COPY package*.json ./

# ì˜ì¡´ì„± ì„¤ì¹˜ (package-lock.jsonì„ 100% ë”°ë¦„)
RUN npm ci

# ì „ì²´ í”„ë¡œì íŠ¸ ë³µì‚¬
COPY . .

# ğŸ§ª ë¹Œë“œì‹œ ì‚¬ìš©í•  í™˜ê²½ë³€ìˆ˜ ë³µì‚¬
COPY .env .env

# NODE_ENVì— ë”°ë¼ build ë¶„ê¸°
RUN if [ "$BUILD_MODE" = "development" ]; then \
    npm run build --verbose; \
  else \
    npm run build; \
  fi

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ Next.js ì‹¤í–‰
CMD ["npm", "next", "start", "-H", "0,0,0,0"]